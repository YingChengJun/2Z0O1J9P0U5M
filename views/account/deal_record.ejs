<!DOCTYPE html>
<html lang="en" data-textdirection="ltr" class="loading">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description"
        content="Robust admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
  <meta name="keywords"
        content="admin template, robust admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="PIXINVENT">
  <title>付款清单</title>
  <script type="text/javascript">var typeOfUser="";</script>
  <script> typeOfUser = "<%=typeOfUser%>" </script>
  <link rel="apple-touch-icon" sizes="60x60" href="../app-assets/images/ico/apple-icon-60.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../app-assets/images/ico/apple-icon-76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../app-assets/images/ico/apple-icon-120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../app-assets/images/ico/apple-icon-152.png">
  <link rel="shortcut icon" type="image/x-icon" href="../app-assets/images/ico/favicon.ico">
  <link rel="shortcut icon" type="image/png" href="../app-assets/images/ico/favicon-32.png">
  <script src="../jquery/jquery.js"></script>
  <script src="../bootstrap/js/bootstrap.min.js"></script>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <!-- BEGIN VENDOR CSS-->
  <link rel="stylesheet" type="text/css" href="../app-assets/css/bootstrap.css">
  <!-- font icons-->
  <link rel="stylesheet" type="text/css" href="../app-assets/fonts/icomoon.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/fonts/flag-icon-css/css/flag-icon.min.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/vendors/css/extensions/pace.css">
  <!-- END VENDOR CSS-->
  <!-- BEGIN ROBUST CSS-->
  <link rel="stylesheet" type="text/css" href="../app-assets/css/bootstrap-extended.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/css/app.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/css/colors.css">
  <!-- END ROBUST CSS-->
  <!-- BEGIN Page Level CSS-->
  <link rel="stylesheet" type="text/css" href="../app-assets/css/core/menu/menu-types/vertical-menu.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/css/core/menu/menu-types/vertical-overlay-menu.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/vendors/css/documentation.css">
  <!-- END Page Level CSS-->
  <!-- BEGIN Custom CSS-->
  <link rel="stylesheet" type="text/css" href="../assets/css/style.css">
  <!-- END Custom CSS-->
</head>

<body data-open="click" data-menu="vertical-menu" data-col="2-columns"
      class="vertical-layout vertical-menu 2-columns  fixed-navbar">

<!-- - var navbarCustom = "navbar-fixed-top navbar-semi-dark navbar-shadow"-->
<!-- navbar-fixed-top-->
<nav class="header-navbar navbar navbar-with-menu navbar-fixed-top navbar-semi-dark navbar-shadow">
  <div class="navbar-wrapper">
    <div class="navbar-header">
      <ul class="nav navbar-nav">
        <!-- <li class="nav-item mobile-menu hidden-md-up float-xs-left"><a class="nav-link nav-menu-main menu-toggle hidden-xs"><i class="icon-menu5 font-large-1">
                <div class="bs-callout-info callout-border-left mt-1 p-1">
                <strong>Great Job!</strong>
                <p>Biscuit macaroon tootsie roll croissant. Dessert candy canes halvah cookie liquorice. Candy canes muffin gummies jujubes brownie. Pie cake pie pastry sugar plum jelly apple pie cotton candy.</p></i>
              </div></a></li> -->
        <!-- <li class="nav-item"><a href="index" class="navbar-brand nav-link"><img alt="branding logo" src="../app-assets/images/logo/robust-logo-light.png" data-expand="../app-assets/images/logo/robust-logo-light.png" data-collapse="../app-assets/images/logo/robust-logo-small.png" class="brand-logo"></a></li> -->
        <li class="nav-item"><a href="" class="navbar-brand nav-link">在线支付系统</a></li>
        <li class="nav-item hidden-md-up float-xs-right"><a data-toggle="collapse" data-target="#navbar-mobile"
                                                            class="nav-link open-navbar-container"><i class="icon-ellipsis pe-2x fa-rotate-90"></i></a></li>
      </ul>
    </div>
    <div class="navbar-container content">
      <div id="navbar-mobile" class="collapse navbar-toggleable-sm">
        <ul class="nav navbar-nav">
          <li class="nav-item hidden-sm-down"><a class="nav-link nav-menu-main menu-toggle hidden-xs"><i
                      class="icon-menu5"></i></a></li>
          <li class="nav-item hidden-sm-down"><a href="#" class="nav-link nav-link-expand"><i
                      class="ficon icon-expand2"></i></a></li>
        </ul>
        <ul class="nav navbar-nav float-xs-right">
          <li class="nav-item">
            <button id="login-btn" class="btn btn-success btn-doc-header" type="button">
              <i class="icon-bag3"></i>
              登陆
            </button></li>
          <li class="nav-item"><a href="account" target="_blank" class="btn btn-success btn-doc-header"><i
                      class="icon-bag3"></i> 我的</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- ////////////////////////////////////////////////////////////////////////////-->


<!-- main menu-->
<div data-scroll-to-active="true" class="main-menu menu-fixed menu-dark menu-accordion menu-shadow">
  <!-- main menu header-->
  <!-- / main menu header-->
  <!-- main menu content-->
  <div class="main-menu-content menu-accordion">
    <ul id="main-menu-navigation" data-menu="menu-navigation" class="navigation navigation-main">
      <li class=" nav-item"><a href="index"><i class="icon-home3"></i><span data-i18n="nav.dash.main"
                                                                            class="menu-title">我的账户</span></a>
        <ul class="menu-content">
          <li class="active"><a href="account" data-i18n="nav.dash.main" class="menu-item">修改信息</a>
          </li>
          <li><a href="change_passwd" data-i18n="nav.dash.main" class="menu-item">密码修改</a>
          </li>
          <li><a href="balance" data-i18n="nav.dash.main" class="menu-item">余额与充值</a>
          </li>
          <li><a href="deal_record" data-i18n="nav.dash.main" class="menu-item">交易记录</a>
          </li>
          <% if(typeOfUser==3) { %> <li><a href="admin" data-i18n="nav.dash.main" class="menu-item">管理后台</a></li> <li><a href="/check" data-i18n="nav.dash.main" class="menu-item">用户对账</a></li><%} %>
          </li>
        </ul>
      </li>
      </li>
      <li class=" nav-item"><a href="/book/hotel_hotelsearch"><i class="icon-android-menu"></i><span
                  data-i18n="" class="menu-title">在线预定</span></a>
      </li>
      <li class=" nav-item"><a href="/payment"><i class="icon-folder3"></i><span data-i18n=""
                                                                                    class="menu-title">我的订单</span></a>
      </li>
    </ul>
  </div>
  <!-- /main menu content-->
  <!-- main menu footer-->
  <!-- main menu footer-->
</div>
<!-- / main menu-->

<div class="app-content content container-fluid">
    <div class="content-wrapper">
      <div class="content-header row">
        <div class="content-header-left col-md-6 col-xs-12 mb-1">
          <button id="select" class="btn btn-success btn-doc-header" type="button">筛选</button>
        </div>

        <div class="modal fade" id="select_model" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title">筛选条件</h4>
              </div>
              <div class="modal-body form-horizontal">
                <div class="form-group">
                  <div class="form-group">
                    <label class="col-sm-2 control-label">年份区间</label>
                      <div class="col-sm-3" style="padding-left:0">
                        <input type="text" class="form-control" name="start_time_year">
                      </div>
                      <label class="control-label col-sm-2" style="text-align:center;">~</label>
                      <div class="col-sm-3" style="padding-left:0">
                        <input type="text" class="form-control" name="end_time_year">
                      </div>
                      <label class="control-label"></label>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">日期区间</label>
                      <div class="col-sm-3" style="padding-left:0">
                        <input type="text" class="form-control" name="start_time_date">
                      </div>
                      <label class="control-label col-sm-2" style="text-align:center;">~</label>
                      <div class="col-sm-3" style="padding-left:0">
                        <input type="text" class="form-control" name="end_time_date">
                      </div>
                      <label class="control-label"></label>
                  </div>
                <div class="form-group">
                          <label class="col-sm-2 control-label">排序方式</label>
                            <div class="col-sm-3" style="padding-left:0">
                    <select class="form-control" name="sort_method">
                      <option value="0">订单编号</option>
                      <option value="1">订单时间</option>
                      <option value="2">订单金额</option>
                    </select>
                            </div>
                            <div class="col-sm-3" style="padding-left:0">
                              <select class="form-control" name="sort_type">
                      <option value="0">升序</option>
                      <option value="1">降序</option>
                    </select>
                      </div>
                          <label class="control-label"></label>
                      </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-success"  onclick="refresh()">重置</button>
                <button type="button" class="btn btn-primary" onclick="select()">筛选</button>
              </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal -->
        </div>

      </div>
      <div class="content-body">
        <!-- Overview -->

        <div class="container">
          <div class="row">
            <table class="table table-hover panel panel-default" id="order_table">
              <thead>
                <tr>
                  <th class="col-lg-2">交易id</th>
                  <th class="col-lg-2">交易时间</th>
                  <th class="col-lg-2">交易内容</th>
                  <th class="col-lg-2">交易金额</th>
                  <th class="col-lg-2">买方id</th>
                  <th class="col-lg-2">卖方id</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script type="text/javascript">
    $(function () {
      $.ajax({
        dataType: "JSON",
        url: "/account/queryOrder",
        type: "POST",
        success: function (data) {
          $("#order_table tbody").empty();
          for (let i = 0; i < data.orders.length; i++)
            show_order(data.orders[i]);
        },
        error: function (err) {
          alert("请求失败!");
        }
      });
    });
    $('#select').click(function(){
			$('#select_model').modal('show');
    });
    function select() {
        let error = "";
        let start_time_year = $("input[name='start_time_year']").val();
        let end_time_year = $("input[name='end_time_year']").val();
        let start_time_date = $("input[name='start_time_date']").val();
        let end_time_date = $("input[name='end_time_date']").val();
        let sort_method = $("select[name='sort_method']").val();
        let sort_type = $("select[name='sort_type']").val(); 
        if (start_time_year!="" && (!testint(start_time_year) || start_time_year.length != 4)) error = "起始年份不合法,正确输入为四位数字表示年份";
        else if (end_time_year!="" && (!testint(end_time_year) || end_time_year.length != 4)) error = "终止年份不合法,正确输入为四位数字表示年份";
        else if (start_time_date!="" && (!testint(start_time_date) || start_time_date.length != 4)) error = "起始日期不合法,正确输入为四位数字表示月份日";
        else if (end_time_date!="" && (!testint(end_time_date) || end_time_date.length !=4)) error = "终止日期不合法,正确输入为四位数字表示月份日期";
        if (error) {
            alert(error);
            return;
        } else {
            if (start_time_date == "") start_time = 0;
                if (end_time_date == "") end_time = 9999;
                if (start_time_year == "") start_price = 0;
                if (end_time_year == "") end_price = 9999;
            $.ajax({
                dataType: "JSON",
                data: {
                    start_time_date:start_time_date,
                    end_time_date:end_time_date,
                    start_time_year:start_time_year,
                    end_time_year:end_time_year,
                    sort_method: sort_method,
                    sort_type: sort_type
                },
                url: "/account/deal_record",
                type: "POST",
                success: function(data) {
                    refresh();
                    $("#order_table tbody").empty();
                    for (let i = 0; i < data.orders.length; i++) {
                    //console.log(data.orders[i]);
                    show_order(data.orders[i]);
                }
                // refresh();
                    $('#select_model').modal('hide');
                },
                error: function(err) {
                    alert("请求失败!");
                }
            });
        }
    }
    function show_order(order) {
      let time = order.created_time;
      time = time.substring(0, 10);
      $("#order_table tbody").append(
        "<tr>\n" +
        "<td class=\"col-lg-2\">" + order.order_id + "</td>\n" +
        "<td class=\"col-lg-2\">" + time + "</td>\n" +
        "<td class=\"col-lg-2\">" + order.information + "</td>\n" +
        "<td class=\"col-lg-2\">" + order.amount + "</td>\n" +
        "<td class=\"col-lg-2\">" + order.from_id + "</td>\n" +
        "<td class=\"col-lg-2\">" + order.to_id + "</td>\n"
      );
    }
    function refresh(){
    		$("input[name='start_time_year']").val("");
    		$("input[name='end_time_year']").val("");
    		$("input[name='start_time_date']").val("");
    		$("input[name='end_time_date']").val("");
		  	$("select[name='sort_method']").val(0);
			  $("select[name='sort_type']").val(0);			
		}
		function testint(value){  // 正则表达式判断是否是正整数
		    const reg = /^[0-9]+$/;
		    return reg.test(value);
		}
  </script>

  <!-- <footer class="footer footer-static footer-light navbar-border">
      <p class="clearfix text-muted text-sm-center mb-0 px-2"><span class="float-md-left d-xs-block d-md-inline-block">Copyright  &copy; 2017 <a href="https://themeforest.net/user/pixinvent/portfolio?ref=pixinvent" target="_blank" class="text-bold-800 grey darken-2">PIXINVENT </a>, All rights reserved. </span><span class="float-md-right d-xs-block d-md-inline-block">Hand-crafted & Made with <i class="icon-heart5 pink"></i></span></p>
    </footer> -->

  <!-- BEGIN VENDOR JS-->
  <script src="../app-assets/js/core/libraries/jquery.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/tether.min.js" type="text/javascript"></script>
  <script src="../app-assets/js/core/libraries/bootstrap.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/unison.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/blockUI.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/jquery.matchHeight-min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/screenfull.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/extensions/pace.min.js" type="text/javascript"></script>
  <!-- BEGIN VENDOR JS-->
  <!-- BEGIN PAGE VENDOR JS-->
  <!-- END PAGE VENDOR JS-->
  <!-- BEGIN ROBUST JS-->
  <script src="../app-assets/js/core/app-menu.js" type="text/javascript"></script>
  <script src="../app-assets/js/core/app.js" type="text/javascript"></script>
  <!-- END ROBUST JS-->
  <!-- BEGIN PAGE LEVEL JS-->
  <script src="../app-assets/js/scripts/documentation.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/affix.js" type="text/javascript"></script>
  <!-- END PAGE LEVEL JS-->
  <script type="text/javascript">
    $(document).ready(function () {
      if (sessionStorage.getItem('loggedIn'))
        document.getElementById("login-btn").innerHTML = "<i class=\"icon-bag3\"></i> 退出";
      else
        document.getElementById("login-btn").innerHTML = "<i class=\"icon-bag3\"></i> 登录";
    })
    $("#login-btn").click(function () {
      if (sessionStorage.getItem('loggedIn'))
        $.post("/account/exit", function (data) {
          if (data.status == 1) {
            alert("登出成功");
            sessionStorage.clear();
            window.location.href = "./login";
          }
          if (data.status == 0) alert("登出失败");
        });
      else
        window.location.href = "./login";
    });
  </script>
</body>

</html>
